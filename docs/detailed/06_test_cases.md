<!--
Depends On: docs/basic_design.md
Depended On By: None
-->
# テスト計画・トレーサビリティ (想定ケース集)

本ドキュメントは `docs/requirements.md` と `docs/usecases.md` を基に、想定テストケースを整理しトレーサビリティを可視化する。開発環境での検証に用いるシードデータは `database/seed/*.sql`（ユーザー・会議室・備品）を前提とする。

## 1. 要件・ユースケース対応表

| 要件ID | 出典 (requirements.md) | 概要 | 関連ユースケース (usecases.md) |
| :--- | :--- | :--- | :--- |
| **RQ-FUNC-01** | §3.1-1 高度な繰り返し予定 | 繰り返し予定の登録/編集/例外処理に対応する。 | UC-01, UC-05 |
| **RQ-FUNC-02** | §3.1-2 代理操作機能 | 秘書など代理人による予定登録・更新・承認を許可する。 | UC-03, UC-10 |
| **RQ-FUNC-03** | §3.1-3 施設・備品管理 | 会議室・備品の空き状況を管理し、連続予約制限を設ける。 | UC-01, UC-07 |
| **RQ-AI-01** | §3.2 スマート日程調整 | 自然言語から候補日時・会議室を提案する（将来実装）。 | UC-02, UC-09 |
| **RQ-SEC-01** | §4.6 セキュリティ・ガバナンス | SSO/MFA、RBAC、監査ログを備える。 | UC-03, UC-10 |
| **RQ-OPS-01** | §4.2 可観測性・運用監視 | 主要ユースケースのログ/トレース/メトリクスを収集する。 | UC-01, UC-07 |

## 2. 想定テストケース一覧（トレース付き）

| テストID | シナリオ | 対応要件ID | 対応UC | 前提データ/モック | 期待結果 |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **TC-01** | 新規予定作成時に会議室・備品を同時に予約し、二重予約を防止する。 | RQ-FUNC-03, RQ-OPS-01 | UC-01 | `resources.sql` の会議室A・備品A。 | 予約が成功し、同時間帯の重複リクエストが 409/バリデーションで拒否される。メトリクスに予約成功/失敗が記録される。 |
| **TC-02** | 繰り返し予定の「今回のみ/以降すべて」編集と削除の分岐を検証する。 | RQ-FUNC-01 | UC-05 | 繰り返し予定3件をシード（週次、終了日あり）。 | 単一インスタンス更新時は他の回へ影響しない。系列更新時は以降の回にのみ反映され、履歴が残る。 |
| **TC-03** | 代理人が上長の予定を登録し、承認フローが必要な場合に通知される。 | RQ-FUNC-02, RQ-SEC-01 | UC-03, UC-10 | `users.sql` に代理人/上長ロール、承認必須会議種別を追加。 | RBAC に基づき代理操作が許可され、承認フラグ付き予定が作成される。承認者へ通知イベントが発火する。 |
| **TC-04** | 会議開始時のチェックイン未実施で自動キャンセルし、リソースを解放する。 | RQ-FUNC-03, RQ-OPS-01 | UC-07 | チェックイン期限10分・会議室Aに対し未チェックイン状態をシード。 | 期限超過でステータスが「キャンセル」へ遷移し、会議室Aが空きに戻る。監査ログに自動キャンセルが記録される。 |
| **TC-05** | 外部ゲストを含む予定で公開範囲設定を確認し、非公開情報がマスクされる。 | RQ-SEC-01 | UC-04, UC-06 | 外部ゲストメールと社内参加者をシード。 | 公開範囲が「時間のみ」の場合、タイトル/詳細がマスクされる。外部ゲストには招待メールが送付され、内部ユーザーにはフル情報が見える。 |
| **TC-06** | AI 日程調整リクエストに対し、候補スロットと会議室が返る（将来実装）。 | RQ-AI-01 | UC-02 | 3名の空きスケジュールと会議室A/Bの空き枠をシード。 | 「来週1時間」の指示に対し、候補日時と会議室候補が3件以上返る。該当 API のレスポンスが構造化 JSON で返却される。 |
| **TC-07** | 依存ライブラリに既知の脆弱性がある場合、CIパイプラインが失敗する。 | RQ-SEC-01 | - | 脆弱性のあるライブラリバージョンを指定した `go.mod` / `package.json`。 | `trivy` 等のセキュリティスキャンで High 以上の脆弱性が検知され、ビルドがブロックされる。 |
| **TC-08** | AI機能の品質指標（誤提案率）が悪化した場合、自動的にキルスイッチが作動する（将来実装）。 | RQ-AI-01 | - | モックメトリクスで誤提案率 > 10% を送信。 | AI機能のエンドポイントが 503 またはフォールバック応答を返し、アラートが発報される。 |
| **TC-09** | 災害復旧演習において、バックアップからのリストアとシステム復旧がRTO目標時間内に完了する。 | RQ-OPS-01 | - | 本番相当のデータ量を持つDBスナップショット。 | 新環境へのリストアとアプリケーション起動が1時間以内に完了し、正常にアクセス可能となる。 |

> 追加のフィクスチャやモック（メール送信・通知・AI API 等）が必要な場合は、`backend/testdata/` または `frontend/__mocks__/` 配下に配置し、上記テストIDにひもづけて管理する。

## 3. 受入基準（要件ID対応）

- **RQ-FUNC-01:** TC-02 の「今回のみ/以降すべて」分岐が再現でき、他インスタンスへ副作用がないこと。
- **RQ-FUNC-02 & RQ-SEC-01:** TC-03 で代理ロールのみが対象予定を登録でき、監査ログが残ること。
- **RQ-FUNC-03:** TC-01/TC-04 で二重予約防止と自動解放の両方が機能し、リソース状態が正しく更新されること。
- **RQ-AI-01:** TC-06 で自然言語入力から候補提示が行われ、サジェスト結果が API スキーマに準拠すること（Future Scope でもスキーマを確定）。
- **RQ-OPS-01:** TC-01/TC-04 実行時にログ・トレース・メトリクスが観測基盤へ流れること（メトリクス名/タグが定義済み）。

