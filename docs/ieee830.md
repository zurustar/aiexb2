<!--
Depends On: docs/requirements.md, docs/usecases.md
Depended On By: docs/basic_design.md
-->
# ソフトウェア要求仕様書 (SRS)
**Software Requirements Specification**

| 項目 | 内容 |
| :--- | :--- |
| **プロジェクト名称** | 企業向け次世代統合スケジュール管理システム |
| **文書バージョン** | 1.0.0 |
| **作成日** | 2025年11月23日 |
| **対象システム** | Enterprise Schedule Management System (ESMS) |


## 1. はじめに (Introduction)

### 1.1 目的 (Purpose)
本文書は、企業向け統合スケジュール管理システムの機能要件および非機能要件を定義するものである。本仕様書は、設計、実装、および検証（テスト）の基準となる。

### 1.2 適用範囲 (Scope)
本システムは、全社規模（10,000名未満）のスケジュール管理、会議室および備品のリソース管理を一元化するWebアプリケーションである。
従来の静的な管理に加え、生成AI（LLM）を活用した「スマート日程調整機能」を実装し、日程調整にかかる工数を劇的に削減することを目標とする。

### 1.3 定義・略語 (Definitions, Acronyms, and Abbreviations)
* **User:** 本システムを利用するすべての社員。
* **Resource:** 予約対象となる会議室、備品、社用車などの物理資産。
* **Conflict:** 同一リソースまたは同一ユーザーに対する重複予約の状態（ダブルブッキング）。
* **AIDD:** AI-Driven Development（AI駆動開発）。本プロジェクトの開発手法。
* **SSO:** Single Sign-On。


## 2. 全体説明 (Overall Description)

### 2.1 製品の展望 (Product Perspective)
本システムは、社内イントラネットまたは閉域網（VPN）を経由して利用されるクラウドネイティブ・アプリケーションである。
既存の社内統合ID基盤（IdP）と連携し、ユーザー管理を行う。また、将来的な外部カレンダー（Microsoft 365 / Google Workspace）とのAPI連携を見据えたアーキテクチャを採用する。



### 2.2 ユーザー特性 (User Characteristics)
| ユーザー区分 | 特性・役割 |
| :--- | :--- |
| **一般社員** | 自身の予定管理、会議招集、リソース予約を行う主要ユーザー。ITリテラシーは多様であるため、直感的なUIが求められる。 |
| **秘書/代理人** | 役員等のスケジュールを代理で操作する権限を持つ。迅速かつ正確な操作（ショートカット等）を好むパワーユーザー。 |
| **システム管理者** | マスタ管理、監査ログ確認、システム設定を行う。 |

### 2.3 制約事項 (Constraints)
* **スケーラビリティ:** 朝の始業時（9:00-9:30）に全社員の20%が同時アクセスしても、レスポンス遅延が発生しないこと。
* **ブラウザ互換性:** Google Chrome, Microsoft Edgeの最新版、およびモバイル（iOS/Android）の標準ブラウザに対応すること。
* **開発言語:** AIコード生成の精度を高めるため、バックエンドはGo (Golang) またはNode.js (TypeScript)、フロントエンドはReact (Next.js) を採用すること。


## 3. 個別要件 (Specific Requirements)

本セクションでは、システムが満たすべき詳細要件を、ユースケースと対応付けて定義する。

### 3.1 外部インターフェース要件 (External Interface Requirements)
* **3.1.1 ユーザーインターフェース:**
    * レスポンシブデザインを採用し、PCとモバイルで最適化された表示を提供すること。
    * カレンダー表示は「日・週・月・グループ」の切り替えが可能であること。
* **3.1.2 ソフトウェアインターフェース:**
    * **IdP連携:** SAML 2.0 または OIDC による認証連携。
    * **通知連携:** SMTPサーバー（メール）および社内チャットツールへのWebhook通知。

### 3.2 機能要件 (Functional Requirements)

#### 3.2.1 スケジュール・リソース管理 (Core)
* **REQ-01: 予定のCRUD**
    * ユーザーは自身の予定を作成、参照、更新、削除できること。
    * **UC-01（新規予定登録）** に従い、参加者とリソース（会議室）を同時に確保できること。
* **REQ-02: 排他制御 (Conflict Resolution)**
    * システムは、同一リソース・同一時間帯への重複予約をデータベースレベルで阻止しなければならない。
    * エラー時は、代替の空き会議室を提案すること。
* **REQ-03: 繰り返し予定**
    * 日次、週次、隔週、月次、年次、曜日指定などの複雑な繰り返しルールをサポートすること。
    * 繰り返し予定の「特定回のみ変更」および「以降すべて変更」に対応すること。

#### 3.2.2 コラボレーション・権限 (Collaboration)
* **REQ-04: 代理操作 (Secretary Mode)**
    * **UC-03（代理人による予定登録）** に従い、権限を付与されたユーザーは他者のカレンダーを操作できること。
    * 代理操作の履歴は、操作者と被操作者が明確に区別されてログに残ること。
* **REQ-05: 公開範囲制御**
    * **UC-04（公開範囲設定）** に従い、「公開」「時間枠のみ公開」「非公開」の制御を行うこと。
* **REQ-11: 承認ワークフロー (Approval Workflow)**
    * **UC-10（重要会議の承認フロー）** に従い、一定条件（参加人数、役員参加等）を満たす会議について、上長承認を必須とするフローを実装すること。

#### 3.2.3 AIアシスタント機能 (AI Capabilities)
* **REQ-06: スマート日程調整 (Future Scope)**
    * **UC-02（AI日程調整）** に従い、自然言語による指示から、参加者全員の空き時間と適切なリソースを自動抽出し、提案すること。
    * 検索アルゴリズムは、移動時間や「集中作業時間」の確保も考慮することが望ましい。
* **REQ-10: 会議準備支援 (Meeting Prep) (Future Scope)**
    * **UC-09（AIによる会議準備サジェスト）** に従い、予定のタイトルや参加者から、必要な資料テンプレートや過去の議事録をレコメンドする機能を有すること。

#### 3.2.4 拡張機能 (Extensions)
* **REQ-07: 施設・備品管理 (Facility & Equipment)**
    * 会議室だけでなく、プロジェクター、社用車、Wi-Fiルーター等の備品管理に対応すること。
    * 連続予約制限（特定の部屋の占有防止ロジック）を実装すること。
* **REQ-08: 外部連携 (External Collaboration)**
    * **UC-06（外部ゲスト招待）** に従い、社外メールアドレスへの招待状送付と参加可否連携を行うこと。
* **REQ-09: リソース効率化 (Resource Optimization)**
    * **UC-07（チェックイン）** に従い、利用開始確認と未チェックイン時の自動キャンセル・開放を行うこと。
    * **UC-08（予定延長）** に従い、終了直前のクイック延長操作と、直後の予約確認ロジックを実装すること。
* **REQ-12: キャンセルポリシー (Cancellation Policy)**
    * **UC-11（予定のキャンセルとペナルティ確認）** に従い、直前キャンセルの警告およびペナルティ（ログ記録等）のビジネスルールを適用すること。



### 3.3 性能要件 (Performance Requirements)
* **REQ-P1:** ページロードおよびカレンダー描画は、95%のリクエストにおいて **1.0秒以内** に完了すること。
* **REQ-P2:** 予約実行処理（排他チェック含む）は、**2.0秒以内** に完了すること。
* **REQ-P3:** システムは、秒間 **500リクエスト (500 RPS)** の負荷に耐えうること。

### 3.4 データベース要件 (Database Requirements)
* **REQ-DB1:** データ整合性を保つため、ACID特性を備えたRDBMS（PostgreSQL等）を使用すること。
* **REQ-DB2:** 読み取り負荷分散のため、リードレプリカ構成およびRedisによるキャッシュ層を設けること。

### 3.5 セキュリティ要件 (Security Requirements)
* **REQ-SEC1:** 通信はすべてHTTPS (TLS 1.2以上) で暗号化すること。
* **REQ-SEC2:** クロスサイトスクリプティング (XSS)、SQLインジェクション、CSRF等の一般的なWeb脆弱性対策を実装すること。
* **REQ-SEC3:** すべての更新操作（作成・変更・削除）について、操作ユーザー、タイムスタンプ、操作内容を監査ログとして **1年間** 保持すること。


## 4. 付録: ユースケース詳細 (Appendix: Use Case Details)

### UC-01: 会議室を伴う新規予定の登録
* **アクター:** 一般社員
* **事前条件:** ログイン済み
* **基本フロー:**
    1. ユーザーが日時・タイトル・参加者を入力。
    2. システムが参加者の空き状況を表示。
    3. ユーザーがリソースを選択。
    4. システムが排他チェックを行い、予約を確定。
* **例外フロー:** リソース重複時、システムはエラーを返し代替案を提示。

### 3.2.3 AIアシスタント機能 (Future Scope)
> **Note:** 本機能群（REQ-06, REQ-10）は将来のリリースで実装予定です。

**REQ-06: スマート日程調整 (Future Scope)**
*   **概要:** 自然言語による指示で、複数人の空き時間を検索し、最適な日時と会議室を提案する。
*   **入力:** 「来週の午後、AさんとBさんと予算会議をしたい」等のテキスト。
*   **出力:** 候補日時リスト（3件程度）。
*   **制約:** 外部LLM APIの応答時間は6秒以内を目標とする（SLA除外）。

**REQ-10: 会議準備支援 (Future Scope)**
*   **概要:** 会議のタイトルや参加者に基づき、過去の関連議事録や適切なドキュメントテンプレートをレコメンドする。
*   **トリガー:** 予定詳細画面の表示時。

### UC-02: AIアシスタントによるスマート日程調整
* **アクター:** 一般社員
* **基本フロー:**
    1. ユーザーが「来週、AさんとBさんと会議したい」と入力。
    2. AIが意図を解析し、空き時間とリソースをクロス検索。
    3. 最適な候補を3件提示。
    4. ユーザーが選択し、予約確定。

### UC-03: 代理人による予定登録
* **アクター:** 秘書
* **基本フロー:**
    1. 役員カレンダーへモード切り替え。
    2. 予定登録を実施。
    3. システムは「登録者=秘書」「所有者=役員」として記録。

### UC-09: AIによる会議準備サジェスト
* **アクター:** 一般社員 / AIアシスタント
* **基本フロー:** 予定詳細を開くと、AIがタイトルを解析し、関連する過去議事録やテンプレートを提案する。

### UC-10: 重要会議の承認フロー
* **アクター:** 一般社員（申請者）、上長（承認者）
* **基本フロー:** 大規模会議等の登録時、上長の承認を得るまで「仮予約」状態とし、承認後に確定する。

### UC-11: 予定のキャンセルとペナルティ確認
* **アクター:** 一般社員
* **基本フロー:** 予定キャンセル時、ポリシー（例: 24時間前）を確認し、違反時は警告を表示して監査ログに記録する。

### UC-04: 公開範囲設定とプライバシー制御
* **アクター:** 一般社員
* **基本フロー:**
    1. ユーザーが予定作成時に公開設定（非公開/Busyのみ）を選択。
    2. システムが設定を保存。
    3. 他ユーザー閲覧時、詳細をマスクして表示。

### UC-05: 繰り返し予定の変更・削除
* **アクター:** 一般社員
* **基本フロー:**
    1. ユーザーが繰り返し予定の1つを選択し変更。
    2. システムが「今回のみ」「以降すべて」等の選択肢を提示。
    3. 「今回のみ」選択時、当該インスタンスを例外として切り離して保存。

### UC-06: 外部ゲストの招待と連携
* **アクター:** 一般社員
* **基本フロー:**
    1. ユーザーが社外メールアドレスを参加者に追加。
    2. システムがiCalendar形式の招待メールを送信。
    3. ゲストがメールから参加/不参加を回答。
    4. システムが外部レスポンスを受け取りステータス更新。

### UC-07: 会議室チェックインと自動開放
* **アクター:** 一般社員
* **基本フロー:**
    1. 開始時刻付近にユーザーがチェックイン操作。
    2. システムが利用中ステータスへ変更。
* **例外フロー:**
    * 15分経過してもチェックインがない場合、システムが自動キャンセルしリソースを開放。

### UC-08: 予定の延長
* **アクター:** 一般社員
* **基本フロー:**
    1. 終了10分前にシステムが延長を提案。
    2. ユーザーが延長を選択。
    3. システムが直後の予約を確認し、空きがあれば延長確定。
