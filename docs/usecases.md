# システムユースケース定義書 (System Use Case Specification)

**対象システム:** 企業向け統合スケジュール管理システム  
**文書バージョン:** 1.1 (User Experience Optimized)

**フェーズ:** 要件定義詳細化  
**アクター定義:**

| アクター名 | 概要 |
| :--- | :--- |
| **一般社員 (User)** | 自身の予定管理、他者の予定閲覧、会議招集を行う標準的なユーザー。 |
| **秘書/代理人 (Proxy)** | 役員等のスケジュールを代理で管理する権限を持つユーザー。 |
| **システム管理者 (Admin)** | ユーザー管理、リソース（会議室）管理、ログ監査を行う特権ユーザー。 |
| **AIアシスタント (System)** | 自然言語指示に基づき、検索・提案・登録を補佐するボット機能。 |


## 0. 本文書の目的と更新基準 (About this Document)

本文書は、システムがユーザーに提供する機能と振る舞いを定義する「正」となるドキュメントです。
開発者およびステークホルダーは、以下のタイミングで本文書を参照・更新してください。

*   **目的:**
    *   機能要件（Requirements）を、具体的なユーザー操作とシステム応答の形式（Flow）に落とし込むこと。
    *   実装（Frontend/Backend）およびテスト（E2E Test）の仕様ベースとすること。
*   **更新すべきタイミング:**
    *   `docs/requirements.md` に新しい機能要件が追加された時。
    *   UI/UX設計の変更により、画面遷移や操作フローが大きく変わる時。
    *   実装中に新たなエッジケースやビジネスルール（例外フロー）が発見された時。

## 1. ユースケース一覧 (Use Case Map)

| ID | ユースケース名称 | 区分 | 概要 |
| :--- | :--- | :--- | :--- |
| **UC-01** | **会議室を伴う新規予定の登録** | 基本 | 単発の予定作成とリソース予約（既存通り）。 |
| **UC-02** | **AIアシスタントによるスマート日程調整** | AI | 自然言語による複数人の日程調整（既存通り）。 |
| **UC-03** | **代理人による予定登録** | 権限 | 秘書による代理操作（既存通り）。 |
| **UC-04** | **公開範囲設定とプライバシー制御** |||
| **UC-05** | **繰り返し予定の変更・削除** | **複雑** | 定期予定の「今回のみ」「以降すべて」の変更制御。 |
| **UC-06** | **外部ゲストの招待と連携** | 連携 | 社外メールアドレスへの招待状送付と参加可否連携。 |
| **UC-07** | **会議室チェックインと自動開放** | 効率化 | 実際の利用開始確認。未チェックイン時の自動キャンセル。 |
| **UC-08** | **予定の延長** | 実用 | 終了直前のクイック延長操作。 |
| **UC-09** | **AIによる会議準備サジェスト** | AI | 会議タイトルから資料や議事録をレコメンド。 |
| **UC-10** | **重要会議の承認フロー** | 統制 | 特定条件の会議に対する上長承認プロセス。 |
| **UC-11** | **予定のキャンセルとペナルティ確認** | 運用 | キャンセルポリシーに基づく警告と実行。 |



### UC-01: 会議室を伴う新規予定の登録
最も頻度が高く、データの整合性が求められる基本フローです。

* **アクター:** 一般社員
* **事前条件:** ユーザーがログイン済みであること。
* **基本フロー (Main Success Scenario):**
    1.  ユーザーは、カレンダー上の日時（開始・終了）を選択する。
    2.  ユーザーは、会議タイトルと詳細を入力する。
    3.  ユーザーは、参加者（複数名）を選択する。
    4.  **システムは、選択された日時における参加者の空き状況を表示する。**
    5.  ユーザーは、利用するリソース（会議室A）を選択する。
    6.  **システムは、当該リソースの空き状況を確認する（排他制御チェック）。**
    7.  ユーザーは「登録」ボタンを押下する。
    8.  システムは、予定データとリソース予約データを不可分なトランザクションとして保存する。
    9.  システムは、参加者に招待メール/通知を送信する。
* **代替フロー (Alternative Flows):**
    * **6a. リソース競合:** 選択した会議室が既に埋まっている場合、システムはエラーを表示し、空いている別の会議室を提案する。
    * **8a. 同時書き込み衝突:** 保存直前に他者が同じリソースを予約した場合、システムは「タッチの差で予約されました」と通知し、再選択を促す。

### UC-02: AIアシスタントによるスマート日程調整
1万人規模でこそ真価を発揮する、AI活用の目玉機能です。

* **アクター:** 一般社員
* **事前条件:** 自然言語入力インターフェースが開かれていること。
* **基本フロー:**
    1.  ユーザーは「来週、A部長とB課長と私の3人で、1時間の予算MTGをしたい。プロジェクターがある部屋で」と入力する。
    2.  **システム(AI)は、入力意図を解析し、期間・参加者・所要時間・リソース条件を抽出する。**
    3.  システムは、対象者全員のスケジュールと、条件に合致する会議室の空き状況をクロス検索する。
    4.  システムは、候補日時をスコア順（全員の移動時間が少ない等）に3つ提示する。
    5.  ユーザーは、提示された候補から1つを選択する。
    6.  システムは、予定とリソースを確定登録する。
* **例外フロー:**
    * **3a. 候補なし:** 全員の空き時間が存在しない場合、システムは「A部長の予定が埋まっています。再来週で探しますか？あるいはA部長を除外しますか？」と対案を提示する。


### UC-03: 代理人による予定登録（秘書モード）
役員スケジュール管理に必須の機能です。

* **アクター:** 秘書/代理人
* **事前条件:** ユーザーが「被代理人（役員）」の代理操作権限を付与されていること。
* **基本フロー:**
    1.  ユーザーは、操作対象を「自分のカレンダー」から「役員カレンダー」に切り替える。
    2.  システムは、UIのテーマ色を変更し、現在「代理モード」であることを明示する。
    3.  ユーザーは、UC-01と同様の手順で予定を登録する。
    4.  システムは、登録者を「秘書」、所有者を「役員」としてデータを保存する。
    5.  システムは、役員本人に「秘書により予定が追加されました」と通知する。

### UC-04: 公開範囲設定とプライバシー制御
全社員公開が基本ですが、機密情報の保護が必要です。

* **アクター:** 一般社員
* **基本フロー:**
    1.  ユーザーは「人事評価面談」の予定を作成する。
    2.  ユーザーは、公開設定を「非公開（Private）」または「時間枠のみ公開（Busy）」に設定する。
    3.  システムは設定を保存する。
    4.  **他のユーザー（参加者以外）**が当該ユーザーのカレンダーを閲覧する。
    5.  システムは、当該時間枠を「予定あり」とのみ表示し、詳細（件名・場所）はマスクして表示する。
* **事後条件:** 管理者権限を持つユーザーであっても、監査ログ以外の画面では内容を参照できない（※ポリシーによる）。



### UC-05: 繰り返し予定の変更・削除
システムロジックとして最もバグを生みやすく、かつユーザー利便性に直結する重要機能です。

* **アクター:** 一般社員（主催者）
* **事前条件:** 「毎週月曜 10:00」の繰り返し予定が登録済みであること。
* **基本フロー (今回のみ変更):**
    1.  ユーザーはカレンダー上の「来週の月曜の予定」を選択し、「変更」を押下する。
    2.  システムは「**この予定のみ変更**」か「**以降の全予定を変更**」か「**全シリーズを変更**」かの選択肢を提示する。
    3.  ユーザーは「**この予定のみ**」を選択する。
    4.  ユーザーは日時を「火曜 10:00」に変更し、保存する。
    5.  システムは、元の繰り返しルール（親データ）から当該日のインスタンスを切り離し（例外化）、独立した予定として保存する。
    6.  システムは、この変更された1件についてのみ、参加者へ通知を送る。
* **代替フロー (全変更):**
    * ユーザーが「以降すべて」を選択した場合、繰り返しルールの終了日を更新し、新しいルールで新規シリーズを作成するなどの再計算を行う。



### UC-06: 外部ゲストの招待と連携
社内システムで完結しない、現代のビジネスシーンに必須の機能です。

* **アクター:** 一般社員
* **基本フロー:**
    1.  ユーザーは予定登録画面の参加者欄に、社外のメールアドレス（例: `client@gmail.com`）を入力する。
    2.  システムは社内ユーザーDBに存在しないことを検知し、「外部ゲスト」としてリストに追加する。
    3.  予定確定時、システムはiCalendar形式（.icsファイル）を添付した招待メールを当該アドレスへ送信する。
    4.  外部ゲストがメール内のリンク（Googleカレンダー等の機能）で「参加」「不参加」をクリックする。
    5.  **システムは外部からのレスポンス（メール返信やAPI連携）を受け取り、本システム上の参加者ステータスを更新する。**

### UC-07: 会議室チェックインと自動開放
リソースの有効活用（空予約撲滅）のための機能です。

* **アクター:** 一般社員
* **事前条件:** 会議室を予約した予定の開始時刻が近づいていること（例: 開始10分前～開始15分後）。
* **基本フロー:**
    1.  ユーザーは会議室前のタブレット、または自身のスマホアプリから当該予定詳細を開く。
    2.  ユーザーは「チェックイン（入室）」ボタンを押下する（位置情報やQRコード利用も想定）。
    3.  システムはステータスを「利用中」に変更する。
* **例外フロー (自動キャンセル):**
    1.  予約開始時刻から「15分」が経過してもチェックインが行われない。
    2.  システムは、予約者に「チェックインが確認できないため自動キャンセルします」と通知する。
    3.  **システムは会議室の予約を解放し、カレンダー上からリソースの紐付けを解除する（予定自体は残るが場所は消える）。**
    4.  空いた会議室は即座に他のユーザーが予約可能となる。

### UC-08: 予定の延長
会議終了間際の「あとちょっと」に対応する機能です。

* **アクター:** 一般社員（主催者）
* **事前条件:** 現在進行中の会議が、終了時刻の10分前であること。
* **基本フロー:**
    1.  システムは会議室内のディスプレイ、または参加者のPC画面に「終了10分前です。延長しますか？」と通知を表示する。
    2.  ユーザーは「30分延長」ボタンを押下する。
    3.  **システムは、直後の時間帯（例: 11:00-11:30）に当該会議室の別予約が入っていないか確認する。**
    4.  予約がない場合、終了時刻を更新し、延長を確定する。
* **例外フロー (延長不可):**
    * 直後に別の予約が入っている場合、システムは「次の予約が入っているため延長できません」と警告する。


### UC-09: AIによる会議準備サジェスト
会議の質を向上させるためのAI支援機能です。

* **アクター:** 一般社員 / AIアシスタント
* **事前条件:** 予定が登録されていること。
* **基本フロー:**
    1.  ユーザーが予定詳細画面を開く。
    2.  **AIシステムは、予定のタイトル（例：「Q3予算策定会議」）と参加者を解析する。**
    3.  システムは、関連する過去の議事録、社内Wikiのテンプレート（「予算案フォーマット」等）、関連ドキュメントをサイドパネルに「準備はお済みですか？」としてサジェストする。
    4.  ユーザーはサジェストされたドキュメントをクリックし、閲覧または添付する。

### UC-10: 重要会議の承認フロー
コストのかかる会議や重要度の高い会議に対するガバナンス機能です。

* **アクター:** 一般社員（申請者）、上長（承認者）
* **事前条件:** システム設定で「参加者10名以上」または「役員参加」の会議に承認フローが設定されていること。
* **基本フロー:**
    1.  ユーザーが条件に合致する大規模会議を登録しようとする。
    2.  システムは「この会議は承認が必要です」と表示し、ステータスを「承認待ち (Pending)」として仮登録する。
    3.  システムは、承認者（上長）へ承認依頼通知を送信する。
    4.  承認者が通知から詳細を確認し、「承認」ボタンを押下する。
    5.  システムはステータスを「確定 (Confirmed)」に変更し、参加者へ招待を送信する。
* **代替フロー (却下):**
    * 承認者が「却下」を選択した場合、理由を入力し、申請者へ差し戻す。予定はキャンセルされる。

### UC-11: 予定のキャンセルとペナルティ確認
直前キャンセルによるリソースの無駄を防ぐための運用ルール適用です。

* **アクター:** 一般社員
* **事前条件:** 既に確定した予定が存在すること。
* **基本フロー:**
    1.  ユーザーが予定の「キャンセル」ボタンを押下する。
    2.  **システムは、現在時刻と予定開始時刻を比較し、キャンセルポリシー（例：24時間前まで無料）を確認する。**
    3.  ポリシー違反がない場合、そのままキャンセルを実行する。
* **代替フロー (ペナルティ警告):**
    * 直前キャンセルの場合、システムは「開始24時間を切っているため、ペナルティ（部署へのコスト請求等）が発生する可能性があります。続行しますか？」と警告ダイアログを表示する。
    * ユーザーが「同意してキャンセル」を選択した場合、キャンセルを実行し、監査ログにペナルティ対象として記録する。


